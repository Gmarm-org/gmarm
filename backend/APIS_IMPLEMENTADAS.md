# üìã APIS IMPLEMENTADAS - SISTEMA DE IMPORTACI√ìN DE ARMAS

## üèóÔ∏è **ARQUITECTURA DEL SISTEMA**

```
Frontend (Next.js) ‚Üî API Gateway ‚Üî Backend (Spring Boot) ‚Üî PostgreSQL
```

## üéØ **ROLES Y M√ìDULOS PRINCIPALES**

1. **VENDEDOR** - Gesti√≥n de clientes y asignaci√≥n de armas
2. **JEFE DE VENTAS** - Aprobaci√≥n y gesti√≥n de importaciones  
3. **FINANZAS** - Gesti√≥n de pagos y facturaci√≥n
4. **OPERACIONES** - Gesti√≥n de importaci√≥n y documentaci√≥n
5. **ADMINISTRADOR** - Gesti√≥n de usuarios y configuraci√≥n

## üìö **ENTIDADES IMPLEMENTADAS**

### **Usuarios y Roles**
- ‚úÖ `Usuario` - Gesti√≥n de usuarios del sistema
- ‚úÖ `Rol` - Roles y permisos
- ‚úÖ `usuario_rol` - Relaci√≥n muchos a muchos

### **Clientes y Tipos**
- ‚úÖ `Cliente` - Informaci√≥n de clientes
- ‚úÖ `TipoCliente` - Tipos de cliente (Civil, Militar, Empresa, Deportista)
- ‚úÖ `TipoIdentificacion` - Tipos de identificaci√≥n
- ‚úÖ `RespuestaCliente` - Respuestas a preguntas
- ‚úÖ `PreguntaCliente` - Preguntas por tipo de cliente
- ‚úÖ `TipoProceso` - Tipos de proceso
- ‚úÖ `TipoImportacion` - Tipos de importaci√≥n

### **Armas y Cat√°logos**
- ‚úÖ `ModeloArma` - Modelos de armas disponibles
- ‚úÖ `CategoriaArma` - Categor√≠as de armas
- ‚úÖ `ArmaFisica` - Armas f√≠sicas con n√∫meros de serie
- ‚úÖ `Accesorio` - Accesorios disponibles
- ‚úÖ `AccesorioFisico` - Accesorios f√≠sicos

### **Importaciones y Licencias**
- ‚úÖ `Licencia` - Licencias de importaci√≥n
- ‚úÖ `GrupoImportacion` - Grupos de importaci√≥n
- ‚úÖ `AsignacionArma` - Asignaci√≥n de armas a clientes
- ‚úÖ `AsignacionAccesorio` - Asignaci√≥n de accesorios

### **Pagos y Finanzas**
- ‚úÖ `PlanPago` - Planes de pago
- ‚úÖ `Pago` - Pagos realizados
- ‚úÖ `CuotaPago` - Cuotas de pago

### **Documentos**
- ‚úÖ `TipoDocumento` - Tipos de documentos
- ‚úÖ `DocumentoCliente` - Documentos de clientes
- ‚úÖ `DocumentoGenerado` - Documentos generados por el sistema

### **Notificaciones**
- ‚úÖ `Notificacion` - Notificaciones del sistema

## üîß **ENUMS IMPLEMENTADOS**

- ‚úÖ `EstadoUsuario` - Estados de usuario
- ‚úÖ `EstadoCliente` - Estados de cliente
- ‚úÖ `EstadoMilitar` - Estados militares
- ‚úÖ `TipoRolVendedor` - Tipos de rol vendedor
- ‚úÖ `EstadoDocumento` - Estados de documentos
- ‚úÖ `EstadoAsignacion` - Estados de asignaci√≥n
- ‚úÖ `EstadoLicencia` - Estados de licencia
- ‚úÖ `EstadoArmaFisica` - Estados de arma f√≠sica
- ‚úÖ `EstadoAccesorioFisico` - Estados de accesorio f√≠sico
- ‚úÖ `TipoPago` - Tipos de pago
- ‚úÖ `EstadoPago` - Estados de pago
- ‚úÖ `EstadoCuotaPago` - Estados de cuota de pago
- ‚úÖ `TipoNotificacion` - Tipos de notificaci√≥n
- ‚úÖ `EstadoNotificacion` - Estados de notificaci√≥n
- ‚úÖ `TipoDocumentoGenerado` - Tipos de documento generado
- ‚úÖ `EstadoDocumentoGenerado` - Estados de documento generado

## üóÑÔ∏è **REPOSITORIOS IMPLEMENTADOS**

### **Usuarios y Roles**
- ‚úÖ `UsuarioRepository` - Operaciones CRUD de usuarios
- ‚úÖ `RolRepository` - Operaciones CRUD de roles

### **Clientes**
- ‚úÖ `ClienteRepository` - Operaciones CRUD de clientes
- ‚úÖ `TipoClienteRepository` - Operaciones de tipos de cliente
- ‚úÖ `ModeloArmaRepository` - Operaciones de modelos de arma

### **Importaciones**
- ‚úÖ `LicenciaRepository` - Operaciones de licencias
- ‚úÖ `CategoriaArmaRepository` - Operaciones de categor√≠as
- ‚úÖ `AccesorioRepository` - Operaciones de accesorios
- ‚úÖ `ArmaFisicaRepository` - Operaciones de armas f√≠sicas

### **Pagos**
- ‚úÖ `PagoRepository` - Operaciones de pagos
- ‚úÖ `PlanPagoRepository` - Operaciones de planes de pago

## üöÄ **SERVICIOS IMPLEMENTADOS**

### **Usuarios**
- ‚úÖ `UsuarioService` - L√≥gica de negocio para usuarios
- ‚úÖ `ClienteService` - L√≥gica de negocio para clientes

### **Importaciones**
- ‚úÖ `LicenciaService` - L√≥gica de negocio para licencias

### **Pagos**
- ‚úÖ `PagoService` - L√≥gica de negocio para pagos

## üåê **CONTROLADORES IMPLEMENTADOS**

### **Usuarios**
- ‚úÖ `UsuarioController` - Endpoints REST para usuarios
- ‚úÖ `LicenciaController` - Endpoints REST para licencias
- ‚úÖ `PagoController` - Endpoints REST para pagos

## üìã **ENDPOINTS DISPONIBLES**

### **üîê USUARIOS** (`/api/usuarios`)

#### **CRUD B√°sico**
- `POST /api/usuarios` - Crear usuario
- `GET /api/usuarios/{id}` - Obtener usuario por ID
- `GET /api/usuarios` - Listar usuarios (paginado)
- `PUT /api/usuarios/{id}` - Actualizar usuario
- `DELETE /api/usuarios/{id}` - Eliminar usuario

#### **Gesti√≥n de Roles**
- `POST /api/usuarios/{id}/roles` - Asignar roles
- `DELETE /api/usuarios/{id}/roles/{rolId}` - Remover rol
- `GET /api/usuarios/{id}/roles` - Obtener roles del usuario

#### **Estados y Seguridad**
- `PUT /api/usuarios/{id}/desbloquear` - Desbloquear usuario
- `PUT /api/usuarios/{id}/bloquear` - Bloquear usuario
- `GET /api/usuarios/vendedores` - Obtener vendedores
- `GET /api/usuarios/por-estado/{estado}` - Usuarios por estado
- `GET /api/usuarios/por-rol/{rolId}` - Usuarios por rol

#### **B√∫squedas**
- `GET /api/usuarios/buscar` - Buscar usuarios con filtros

### **üìÑ LICENCIAS** (`/api/licencias`)

#### **CRUD B√°sico**
- `POST /api/licencias` - Crear licencia
- `GET /api/licencias/{id}` - Obtener licencia por ID
- `GET /api/licencias` - Listar licencias (paginado)
- `PUT /api/licencias/{id}` - Actualizar licencia
- `DELETE /api/licencias/{id}` - Eliminar licencia

#### **Gesti√≥n de Cupos**
- `GET /api/licencias/activas` - Obtener licencias activas
- `GET /api/licencias/cupo-civil-disponible` - Licencias con cupo civil
- `GET /api/licencias/{id}/tiene-cupo` - Verificar cupo disponible
- `POST /api/licencias/{id}/decrementar-cupo` - Decrementar cupo

#### **Estados y Fechas**
- `PUT /api/licencias/{id}/estado` - Cambiar estado
- `GET /api/licencias/proximas-vencer` - Licencias pr√≥ximas a vencer

#### **B√∫squedas y Estad√≠sticas**
- `GET /api/licencias/buscar` - Buscar licencias con filtros
- `GET /api/licencias/estadisticas` - Estad√≠sticas por estado

### **üí∞ PAGOS** (`/api/pagos`)

#### **CRUD B√°sico**
- `POST /api/pagos` - Crear pago
- `GET /api/pagos/{id}` - Obtener pago por ID
- `GET /api/pagos` - Listar pagos (paginado)
- `PUT /api/pagos/{id}` - Actualizar pago
- `DELETE /api/pagos/{id}` - Eliminar pago

#### **Gesti√≥n por Cliente**
- `GET /api/pagos/cliente/{clienteId}` - Pagos por cliente
- `GET /api/pagos/cliente/{clienteId}/saldo` - Saldo del cliente

#### **Filtros y Fechas**
- `GET /api/pagos/por-fecha` - Pagos por rango de fechas
- `GET /api/pagos/pendientes` - Pagos pendientes
- `GET /api/pagos/buscar` - Buscar pagos con filtros

#### **Estados y Utilidades**
- `PUT /api/pagos/{id}/estado` - Cambiar estado
- `GET /api/pagos/estadisticas` - Estad√≠sticas por estado
- `GET /api/pagos/generar-comprobante` - Generar n√∫mero de comprobante

### **üë• CLIENTES** (`/api/clientes`)

#### **CRUD B√°sico**
- `POST /api/clientes` - Crear cliente
- `GET /api/clientes/{id}` - Obtener cliente por ID
- `GET /api/clientes` - Listar clientes (paginado)
- `PUT /api/clientes/{id}` - Actualizar cliente
- `DELETE /api/clientes/{id}` - Eliminar cliente

#### **B√∫squedas Espec√≠ficas**
- `GET /api/clientes/por-vendedor/{vendedorId}` - Clientes por vendedor
- `GET /api/clientes/por-identificacion/{numero}` - Cliente por identificaci√≥n
- `GET /api/clientes/por-estado/{estado}` - Clientes por estado
- `GET /api/clientes/buscar` - Buscar clientes con filtros

## üîí **SEGURIDAD Y AUTORIZACI√ìN**

### **Roles Requeridos**
- `VENDEDOR` - Acceso a gesti√≥n de clientes
- `JEFE_VENTAS` - Acceso a licencias e importaciones
- `FINANZAS` - Acceso a pagos y facturaci√≥n
- `OPERACIONES` - Acceso a gesti√≥n de importaci√≥n
- `ADMIN` - Acceso completo al sistema

### **Anotaciones de Seguridad**
- `@PreAuthorize("hasRole('ROLE')")` - Control de acceso por rol
- `@Valid` - Validaci√≥n de datos de entrada
- `@Transactional` - Control de transacciones

## üìä **VALIDACIONES IMPLEMENTADAS**

### **Usuarios**
- ‚úÖ Username √∫nico
- ‚úÖ Email √∫nico
- ‚úÖ Validaci√≥n de contrase√±a
- ‚úÖ Control de intentos de login
- ‚úÖ Bloqueo autom√°tico

### **Clientes**
- ‚úÖ N√∫mero de identificaci√≥n √∫nico
- ‚úÖ Validaci√≥n de edad m√≠nima
- ‚úÖ Validaci√≥n de email
- ‚úÖ Validaci√≥n de tel√©fonos

### **Licencias**
- ‚úÖ N√∫mero de licencia √∫nico
- ‚úÖ Control de cupos disponibles
- ‚úÖ Validaci√≥n de fechas de vencimiento

### **Pagos**
- ‚úÖ N√∫mero de comprobante √∫nico
- ‚úÖ Validaci√≥n de montos
- ‚úÖ Control de saldos

## üöß **PR√ìXIMOS PASOS**

### **Entidades Faltantes**
- ‚è≥ `GrupoImportacion` - Completar relaciones
- ‚è≥ `DocumentoCliente` - Implementar servicio
- ‚è≥ `Notificacion` - Implementar servicio
- ‚è≥ `DocumentoGenerado` - Implementar servicio

### **Servicios Faltantes**
- ‚è≥ `GrupoImportacionService`
- ‚è≥ `DocumentoService`
- ‚è≥ `NotificacionService`
- ‚è≥ `ArmaFisicaService`
- ‚è≥ `AccesorioService`

### **Controladores Faltantes**
- ‚è≥ `ClienteController`
- ‚è≥ `GrupoImportacionController`
- ‚è≥ `DocumentoController`
- ‚è≥ `NotificacionController`
- ‚è≥ `ArmaFisicaController`

### **Configuraciones**
- ‚è≥ Spring Security con JWT
- ‚è≥ Configuraci√≥n de Swagger
- ‚è≥ Configuraci√≥n de email
- ‚è≥ Configuraci√≥n de archivos

## üìù **NOTAS IMPORTANTES**

1. **Base de Datos**: Todas las entidades incluyen auditor√≠a (`fechaCreacion`, `fechaActualizacion`)
2. **Validaciones**: Implementadas tanto a nivel de entidad como de servicio
3. **Seguridad**: Control de acceso basado en roles implementado
4. **Documentaci√≥n**: Swagger configurado para documentaci√≥n autom√°tica
5. **Manejo de Errores**: Excepciones personalizadas y manejo global

## üîó **ENLACES √öTILES**

- **Swagger UI**: `http://localhost:8080/swagger-ui.html`
- **Base de Datos**: PostgreSQL en puerto 5432
- **API Base**: `http://localhost:8080/api`
- **Documentaci√≥n**: `backend/APIS_IMPLEMENTADAS.md` 