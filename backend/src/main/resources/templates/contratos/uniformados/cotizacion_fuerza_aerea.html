<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Cotización CZ</title>
    <style>
      @page {
        size: A4;
        margin: 18mm;
      }
      body {
        font-family: "Helvetica", "Arial", sans-serif;
        font-size: 10.5pt;
        color: #000;
        margin: 0;
        padding: 0;
        line-height: 1.3;
      }
      .page {
        max-width: 175mm;
        margin: auto;
        position: relative;
        background: white;
      }

      .titulo {
        text-align: center;
        font-size: 14pt;
        font-weight: bold;
        margin-bottom: 20px;
        text-decoration: underline;
      }

      .datos-cliente {
        margin-bottom: 15px;
      }
      .datos-cliente div {
        margin: 3px 0;
      }

      .tabla {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
      }
      .tabla th,
      .tabla td {
        border: 1px solid #000;
        padding: 5px;
        text-align: center;
        font-size: 9pt;
      }
      .tabla th {
        background-color: #eeeeee;
      }

      .payment-section {
        margin-top: 15px;
      }
      .payment-item {
        margin-bottom: 6px;
        text-align: justify;
      }
      .text-bold {
        font-weight: bold;
      }
      /* Evitar que los montos en texto se corten entre líneas */
      .monto-texto {
        white-space: nowrap;
      }

      /* Sección de banco + firmas: mantener juntos en una página */
      .footer-section {
        page-break-inside: avoid;
        margin-top: 20px;
      }

      .bank-details {
        line-height: 1.5;
      }

      .signatures {
        margin-top: 40px;
        width: 100%;
      }
      .signature-box {
        width: 45%;
        text-align: center;
        vertical-align: top;
        font-size: 9pt;
      }
      .line {
        border-top: 1px dotted #000;
        width: 80%;
        margin: 0 auto 8px auto;
      }

      @media print {
        .page {
          margin: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <div class="titulo">
        COTIZACIÓN: <span th:text="${numeroCotizacion}">ML-0001-2026</span>
      </div>

      <div class="datos-cliente">
        <div>
          <strong>Fecha:</strong>
          <span th:text="${fechaCotizacion}">Quito, 27 de enero de 2026</span>
        </div>
        <div>
          <strong>Cliente:</strong>
          <span
            th:if="${clienteRango != null and clienteRango != ''}"
            th:text="${#strings.toUpperCase(clienteRango + '. ' + cliente.nombres + ' ' + cliente.apellidos)}"
            >CBOP. QUINTERO CABEZA JOSE LUIS</span
          ><span
            th:unless="${clienteRango != null and clienteRango != ''}"
            th:text="${#strings.toUpperCase(cliente.nombres + ' ' + cliente.apellidos)}"
            >NOMBRE APELLIDO</span
          >
          - FUERZA AEREA EN SERVICIO
          <span th:text="${estadoMilitarUpper}">ACTIVO</span>
        </div>
        <div>
          <strong>Cédula:</strong>
          <span th:text="${cliente.numeroIdentificacion}">0925588196</span>
        </div>
      </div>

      <p>
        Por medio de la presente me permito enviar la Cotización para
        <strong th:text="${cantidadArmasTexto}">01 pistola(s)</strong> de las
        siguientes características:
      </p>

      <table class="tabla">
        <thead>
          <tr>
            <th>TIPO</th>
            <th>MARCA</th>
            <th>MODELO</th>
            <th>CALIBRE</th>
            <th>ALIMENTADORA DE FABRICA</th>
            <th>PRECIO INCLUIDO IVA</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="arma : ${armasDetalle}">
            <td th:text="${arma.categoria}">PISTOLA</td>
            <td th:text="${arma.marca}">CZ</td>
            <td th:text="${arma.modelo}">CZ P10 F</td>
            <td th:text="${arma.calibre}">9MM</td>
            <td th:text="${arma.alimentadora}">2 (DOS)</td>
            <td>
              <strong th:text="${arma.precioConIvaFormateado}"
                >$1.587,00</strong
              >
            </td>
          </tr>
        </tbody>
      </table>

      <p>El arma será cancelada en la siguiente manera:</p>

      <div class="payment-section">
        <!-- Pago de contado -->
        <div
          class="payment-item"
          th:if="${pago != null and pago.tipoPago == 'CONTADO'}"
        >
          <span class="text-bold">a). - </span>A las 24 horas después de la
          suscripción del presente documento la cantidad de USD
          <span th:text="${#numbers.formatDecimal(pago.montoTotal, 1, 2)}"
            >1,380.00</span
          >
          (<span class="monto-texto" th:text="${numberToTextService.convertToText(pago.montoTotal)} + ' DOLARES AMERICANOS'"
            >UN MIL TRESCIENTOS OCHENTA CON 00/100 DOLARES AMERICANOS</span
          >).
        </div>

        <!-- Pago a crédito -->
        <div
          class="payment-item"
          th:if="${pago != null and pago.tipoPago == 'CREDITO'}"
        >
          <span class="text-bold">a). - </span>A las 24 horas después de la
          suscripción del presente documento la cantidad de USD
          <span th:text="${#numbers.formatDecimal(pago.montoCuota, 1, 2)}"
            >230.00</span
          >
          (<span class="monto-texto" th:text="${numberToTextService.convertToText(pago.montoCuota)} + ' DOLARES AMERICANOS'"
            >DOSCIENTOS TREINTA CON 00/100 DOLARES AMERICANOS</span
          >).
        </div>

        <div
          class="payment-item"
          th:if="${pago != null and pago.tipoPago == 'CREDITO' and cuotas != null and cuotas.size() >= 2}"
        >
          <span class="text-bold">b). -</span>Hasta el
          <span th:text="${#temporals.format(cuotas[1].fechaVencimiento, 'dd')}"
            >5</span
          >° de
          <span
            th:text="${T(java.time.format.DateTimeFormatter).ofPattern('MMMM yyyy', new java.util.Locale('es', 'ES')).format(cuotas[1].fechaVencimiento)}"
            >febrero 2026</span
          >, USD
          <span th:text="${#numbers.formatDecimal(cuotas[1].monto, 1, 2)}"
            >230.00</span
          >
          (<span class="monto-texto" th:text="${numberToTextService.convertToText(cuotas[1].monto)} + ' DOLARES AMERICANOS'"
            >DOSCIENTOS TREINTA CON 00/100 DOLARES AMERICANOS</span
          >).
        </div>

        <div
          class="payment-item"
          th:if="${pago != null and pago.tipoPago == 'CREDITO' and cuotas != null and cuotas.size() >= 3}"
        >
          <span class="text-bold">c). -</span>Hasta el
          <span th:text="${#temporals.format(cuotas[2].fechaVencimiento, 'dd')}"
            >5</span
          >° de
          <span
            th:text="${T(java.time.format.DateTimeFormatter).ofPattern('MMMM yyyy', new java.util.Locale('es', 'ES')).format(cuotas[2].fechaVencimiento)}"
            >marzo 2026</span
          >, USD
          <span th:text="${#numbers.formatDecimal(cuotas[2].monto, 1, 2)}"
            >230.00</span
          >
          (<span class="monto-texto" th:text="${numberToTextService.convertToText(cuotas[2].monto)} + ' DOLARES AMERICANOS'"
            >DOSCIENTOS TREINTA CON 00/100 DOLARES AMERICANOS</span
          >).
        </div>

        <div
          class="payment-item"
          th:if="${pago != null and pago.tipoPago == 'CREDITO' and cuotas != null and cuotas.size() >= 4}"
        >
          <span class="text-bold">d). -</span>Hasta el
          <span th:text="${#temporals.format(cuotas[3].fechaVencimiento, 'dd')}"
            >5</span
          >° de
          <span
            th:text="${T(java.time.format.DateTimeFormatter).ofPattern('MMMM yyyy', new java.util.Locale('es', 'ES')).format(cuotas[3].fechaVencimiento)}"
            >abril 2026</span
          >, USD
          <span th:text="${#numbers.formatDecimal(cuotas[3].monto, 1, 2)}"
            >230.00</span
          >
          (<span class="monto-texto" th:text="${numberToTextService.convertToText(cuotas[3].monto)} + ' DOLARES AMERICANOS'"
            >DOSCIENTOS TREINTA CON 00/100 DOLARES AMERICANOS</span
          >).
        </div>

        <div
          class="payment-item"
          th:if="${pago != null and pago.tipoPago == 'CREDITO' and cuotas != null and cuotas.size() >= 5}"
        >
          <span class="text-bold">e). -</span>Hasta el
          <span th:text="${#temporals.format(cuotas[4].fechaVencimiento, 'dd')}"
            >5</span
          >° de
          <span
            th:text="${T(java.time.format.DateTimeFormatter).ofPattern('MMMM yyyy', new java.util.Locale('es', 'ES')).format(cuotas[4].fechaVencimiento)}"
            >mayo 2026</span
          >, USD
          <span th:text="${#numbers.formatDecimal(cuotas[4].monto, 1, 2)}"
            >230.00</span
          >
          (<span class="monto-texto" th:text="${numberToTextService.convertToText(cuotas[4].monto)} + ' DOLARES AMERICANOS'"
            >DOSCIENTOS TREINTA CON 00/100 DOLARES AMERICANOS</span
          >).
        </div>

        <div
          class="payment-item"
          th:if="${pago != null and pago.tipoPago == 'CREDITO' and cuotas != null and cuotas.size() >= 6}"
        >
          <span class="text-bold">f). - </span>Hasta el
          <span th:text="${#temporals.format(cuotas[5].fechaVencimiento, 'dd')}"
            >05</span
          >
          de
          <span
            th:text="${T(java.time.format.DateTimeFormatter).ofPattern('MMMM yyyy', new java.util.Locale('es', 'ES')).format(cuotas[5].fechaVencimiento)}"
            >junio 2026</span
          >, USD
          <span th:text="${#numbers.formatDecimal(cuotas[5].monto, 1, 2)}"
            >230.00</span
          >
          (<span class="monto-texto" th:text="${numberToTextService.convertToText(cuotas[5].monto)} + ' DOLARES AMERICANOS'"
            >DOSCIENTOS TREINTA CON 00/100 DOLARES AMERICANOS</span
          >).
        </div>
      </div>

      <div class="footer-section">
        <div class="bank-details">
          El depósito deberá realizarlo en la cuenta bancaria:<br />
          <strong>Banco:</strong>
          <span th:text="${licenciaNombreBanco}">Banco Guayaquil</span><br />
          <strong>Cuenta:</strong>
          <span th:text="${licenciaTipoCuenta}">AHORROS</span><br />
          <strong>Número:</strong>
          <span th:text="${licenciaCuentaBancaria}">29282140</span>
        </div>

        <div style="margin-top: 15px">
          Para constancia de aceptación de la cotización firman.
        </div>

        <table class="signatures">
          <tr>
            <td class="signature-box">
              <div class="line"></div>
              <strong
                th:text="${#strings.toUpperCase((licenciaTitulo != null and !licenciaTitulo.isEmpty() ? licenciaTitulo + ' ' : '') + licenciaNombre)}"
                >MSC LOYAGA CORREA MARCIA NATHALY</strong
              ><br />
              Distribuidor Autorizado<br />
              Česká Zbrojovka<br />
              CC. <span th:text="${licenciaCedula}">1725831950</span>
            </td>
            <td style="width: 10%"></td>
            <td class="signature-box">
              <div class="line"></div>
              <strong
                th:if="${clienteRango != null and clienteRango != ''}"
                th:text="${#strings.capitalize(clienteRango) + '. ' + #strings.capitalize(cliente.nombres) + ' ' + #strings.capitalize(cliente.apellidos)}"
                >Cbop. Quintero Cabeza Jose Luis</strong
              ><strong
                th:unless="${clienteRango != null and clienteRango != ''}"
                th:text="${#strings.capitalize(cliente.nombres) + ' ' + #strings.capitalize(cliente.apellidos)}"
                >Nombre Apellido</strong
              ><br />
              CC <span th:text="${cliente.numeroIdentificacion}">0925588196</span>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </body>
</html>
