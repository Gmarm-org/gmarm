# ========================================
# CONFIGURACIÓN DE PRODUCCIÓN
# ========================================

# Base de datos de producción
spring.datasource.url=jdbc:postgresql://postgres_prod:5432/gmarm_db
spring.datasource.username=${POSTGRES_USER:produser}
spring.datasource.password=${POSTGRES_PASSWORD:prodpass}
spring.datasource.driver-class-name=org.postgresql.Driver

# Configuración HikariCP para producción (CRÍTICO para estabilidad)
# Pool conservador (20% de max_connections)
# Pool optimizado para producción (servidor con más recursos)
spring.datasource.hikari.maximum-pool-size=5
# Conexiones mínimas: 2 (balance entre performance y RAM)
spring.datasource.hikari.minimum-idle=2
# 30s timeout
spring.datasource.hikari.connection-timeout=30000
# 10min idle
spring.datasource.hikari.idle-timeout=600000
# 30min lifetime
spring.datasource.hikari.max-lifetime=1800000
# Detectar leaks a 1min
spring.datasource.hikari.leak-detection-threshold=60000
# Test simple
spring.datasource.hikari.connection-test-query=SELECT 1
# Timeout validación 5s
spring.datasource.hikari.validation-timeout=5000
# Fallar rápido si no conecta
spring.datasource.hikari.initialization-fail-timeout=1
# Habilitar JMX monitoring
spring.datasource.hikari.register-mbeans=true

# JPA - Configuración optimizada para producción
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
# Hibernate detecta automáticamente el dialecto desde la URL (PostgreSQL)
# No es necesario especificar hibernate.dialect explícitamente
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# JWT Configuration for Production
app.jwt.secret=${JWT_SECRET}
app.jwt.expiration=86400000

# Logging para producción
logging.level.com.armasimportacion=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# Swagger deshabilitado en producción
springdoc.swagger-ui.enabled=false
springdoc.api-docs.enabled=false

# CORS para producción
spring.web.cors.allowed-origins=${ALLOWED_ORIGINS:http://localhost,https://yourdomain.com}
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=*

# Archivos de producción
app.upload.dir=/app/uploads
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB
app.weapons.max-image-size=41943040

# Email de producción
spring.mail.host=${MAIL_HOST}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

# URL del frontend para enlaces de verificación de email
app.frontend.url=${FRONTEND_URL:https://gmarm.com}

# Configuración específica de producción
app.prod-mode=true
app.auto-create-admin=false

# Actuator para monitoreo
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# Cache para producción
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=500,expireAfterWrite=600s

# Configuración de seguridad adicional
server.servlet.session.timeout=30m
# Tomcat threads optimizado (reduce conexiones simultáneas a BD)
server.tomcat.max-threads=20
server.tomcat.min-spare-threads=3 