# üìã ENDPOINTS JEFE DE VENTAS Y VENDEDOR - SISTEMA DE IMPORTACI√ìN DE ARMAS

## üèóÔ∏è **ARQUITECTURA DEL SISTEMA**

```
Frontend (React) ‚Üî API Gateway ‚Üî Backend (Spring Boot) ‚Üî PostgreSQL
```

## üéØ **M√ìDULOS IMPLEMENTADOS**

1. **VENDEDOR** - Gesti√≥n de clientes y asignaci√≥n de armas
2. **JEFE DE VENTAS** - Aprobaci√≥n y gesti√≥n de importaciones  

---

## üîê **AUTENTICACI√ìN**

Todos los endpoints requieren el header:
```
Authorization: Bearer <token>
```

---

## üë®‚Äçüíº **M√ìDULO VENDEDOR** (`/api/vendedor`)

### **GESTI√ìN DE CLIENTES**

#### **Obtener clientes del vendedor**
```http
GET /api/vendedor/clientes?estado=ACTIVO&page=0&size=10
```
**Descripci√≥n:** Obtiene todos los clientes del vendedor logueado
**Roles:** `VENDEDOR`
**Par√°metros:**
- `estado` (opcional): Estado del cliente (ACTIVO, BLOQUEADO, etc.)
- `page` (opcional): N√∫mero de p√°gina (default: 0)
- `size` (opcional): Tama√±o de p√°gina (default: 10)

**Response:**
```json
{
  "content": [
    {
      "id": 1,
      "nombres": "Juan",
      "apellidos": "P√©rez",
      "email": "juan@example.com",
      "estado": "ACTIVO",
      "procesoCompletado": false,
      "fechaCreacion": "2024-01-01T00:00:00Z"
    }
  ],
  "totalElements": 1,
  "totalPages": 1,
  "size": 10,
  "number": 0
}
```

#### **Crear nuevo cliente**
```http
POST /api/vendedor/clientes
```
**Descripci√≥n:** Crea un nuevo cliente para el vendedor
**Roles:** `VENDEDOR`
**Body:**
```json
{
  "nombres": "Juan",
  "apellidos": "P√©rez",
  "email": "juan@example.com",
  "telefonoPrincipal": "0991234567",
  "direccion": "Av. Principal 123",
  "provincia": "Pichincha",
  "canton": "Quito",
  "tipoIdentificacion": {
    "id": 1
  },
  "numeroIdentificacion": "1234567890",
  "tipoCliente": {
    "id": 1
  },
  "fechaNacimiento": "1990-01-01"
}
```

#### **Actualizar cliente**
```http
PUT /api/vendedor/clientes/{id}
```
**Descripci√≥n:** Actualiza un cliente existente del vendedor
**Roles:** `VENDEDOR`
**Body:** Mismo formato que crear cliente

#### **Obtener cliente por ID**
```http
GET /api/vendedor/clientes/{id}
```
**Descripci√≥n:** Obtiene un cliente espec√≠fico del vendedor
**Roles:** `VENDEDOR`

#### **Completar proceso de cliente**
```http
PUT /api/vendedor/clientes/{id}/completar-proceso
```
**Descripci√≥n:** Marca el proceso de datos del cliente como completado
**Roles:** `VENDEDOR`

### **GESTI√ìN DE ARMAS**

#### **Obtener armas disponibles**
```http
GET /api/vendedor/armas
```
**Descripci√≥n:** Obtiene las armas disponibles para asignaci√≥n
**Roles:** `VENDEDOR`

**Response:**
```json
[
  {
    "id": 1,
    "nombre": "Pistola Glock 17",
    "precio": 1500.00,
    "disponible": true,
    "categoria": {
      "id": 1,
      "nombre": "Pistolas"
    }
  }
]
```

#### **Obtener precio de arma**
```http
GET /api/vendedor/armas/{armaId}/precio
```
**Descripci√≥n:** Obtiene el precio actual de una arma espec√≠fica
**Roles:** `VENDEDOR`

**Response:**
```json
{
  "armaId": 1,
  "nombre": "Pistola Glock 17",
  "precio": 1500.00,
  "disponible": true
}
```

### **ASIGNACI√ìN DE ARMAS**

#### **Asignar arma a cliente**
```http
POST /api/vendedor/clientes/{clienteId}/asignar-arma/{armaId}?cantidad=1
```
**Descripci√≥n:** Asigna una arma a un cliente espec√≠fico
**Roles:** `VENDEDOR`
**Par√°metros:**
- `cantidad` (opcional): Cantidad de armas a asignar (default: 1)

**Response:**
```json
{
  "id": 1,
  "cliente": {
    "id": 1,
    "nombres": "Juan",
    "apellidos": "P√©rez"
  },
  "modeloArma": {
    "id": 1,
    "nombre": "Pistola Glock 17"
  },
  "cantidad": 1,
  "estado": "ACTIVA",
  "fechaCreacion": "2024-01-01T00:00:00Z"
}
```

#### **Obtener asignaciones de cliente**
```http
GET /api/vendedor/clientes/{clienteId}/asignaciones
```
**Descripci√≥n:** Obtiene todas las asignaciones de armas de un cliente
**Roles:** `VENDEDOR`

#### **Eliminar asignaci√≥n**
```http
DELETE /api/vendedor/asignaciones/{asignacionId}
```
**Descripci√≥n:** Elimina una asignaci√≥n de arma
**Roles:** `VENDEDOR`

### **ESTAD√çSTICAS**

#### **Estad√≠sticas del vendedor**
```http
GET /api/vendedor/estadisticas
```
**Descripci√≥n:** Obtiene estad√≠sticas de clientes y ventas del vendedor
**Roles:** `VENDEDOR`

**Response:**
```json
{
  "totalClientes": 25,
  "clientesActivos": 20,
  "clientesBloqueados": 3,
  "clientesCompletados": 15,
  "clientesPendientes": 10
}
```

---

## üëî **M√ìDULO JEFE DE VENTAS** (`/api/jefe-ventas`)

### **GESTI√ìN DE CLIENTES**

#### **Obtener todos los clientes**
```http
GET /api/jefe-ventas/clientes?estado=ACTIVO&vendedor=Juan&page=0&size=10
```
**Descripci√≥n:** Obtiene todos los clientes del sistema para revisi√≥n del jefe de ventas
**Roles:** `JEFE_VENTAS`, `ADMIN`
**Par√°metros:**
- `estado` (opcional): Estado del cliente
- `vendedor` (opcional): Nombre del vendedor
- `page` (opcional): N√∫mero de p√°gina
- `size` (opcional): Tama√±o de p√°gina

#### **Obtener clientes aprobados**
```http
GET /api/jefe-ventas/clientes/aprobados
```
**Descripci√≥n:** Obtiene clientes que han completado el proceso de datos y est√°n listos para asignaci√≥n de licencia
**Roles:** `JEFE_VENTAS`, `ADMIN`

#### **Obtener detalle completo de cliente**
```http
GET /api/jefe-ventas/clientes/{clienteId}/detalle
```
**Descripci√≥n:** Obtiene informaci√≥n detallada de un cliente incluyendo documentos y respuestas
**Roles:** `JEFE_VENTAS`, `ADMIN`

**Response:**
```json
{
  "cliente": {
    "id": 1,
    "nombres": "Juan",
    "apellidos": "P√©rez",
    "estado": "ACTIVO",
    "procesoCompletado": true
  },
  "documentos": [
    {
      "id": 1,
      "tipo": "CEDULA",
      "url": "https://example.com/cedula.pdf"
    }
  ],
  "respuestas": [
    {
      "id": 1,
      "pregunta": "¬øTiene denuncias de violencia?",
      "respuesta": "NO"
    }
  ],
  "asignacionesArma": [],
  "asignacionesAccesorio": []
}
```

#### **Aprobar cliente**
```http
PUT /api/jefe-ventas/clientes/{clienteId}/aprobar
```
**Descripci√≥n:** Aprueba un cliente para asignaci√≥n de licencia
**Roles:** `JEFE_VENTAS`, `ADMIN`

#### **Rechazar cliente**
```http
PUT /api/jefe-ventas/clientes/{clienteId}/rechazar?motivo=Documentaci√≥n incompleta
```
**Descripci√≥n:** Rechaza un cliente con motivo
**Roles:** `JEFE_VENTAS`, `ADMIN`

### **GESTI√ìN DE LICENCIAS**

#### **Obtener licencias disponibles**
```http
GET /api/jefe-ventas/licencias
```
**Descripci√≥n:** Obtiene licencias disponibles para asignaci√≥n
**Roles:** `JEFE_VENTAS`, `ADMIN`

#### **Obtener cupos de licencia**
```http
GET /api/jefe-ventas/licencias/{licenciaId}/cupos
```
**Descripci√≥n:** Obtiene informaci√≥n detallada de cupos de una licencia
**Roles:** `JEFE_VENTAS`, `ADMIN`

**Response:**
```json
{
  "licencia": {
    "id": 1,
    "numeroLicencia": "LIC-2024-001",
    "estado": "ACTIVA"
  },
  "cupoCivil": 25,
  "cupoEmpresa": 10,
  "cupoMilitar": 50,
  "cupoDeportista": 100,
  "totalCupos": 185
}
```

#### **Asignar cliente a licencia**
```http
POST /api/jefe-ventas/licencias/{licenciaId}/asignar-cliente/{clienteId}
```
**Descripci√≥n:** Asigna un cliente aprobado a una licencia espec√≠fica
**Roles:** `JEFE_VENTAS`, `ADMIN`

**Response:**
```json
{
  "licenciaId": 1,
  "clienteId": 1,
  "asignado": true,
  "fechaAsignacion": "2024-01-01T00:00:00Z"
}
```

#### **Remover cliente de licencia**
```http
DELETE /api/jefe-ventas/licencias/{licenciaId}/remover-cliente/{clienteId}
```
**Descripci√≥n:** Remueve un cliente de una licencia
**Roles:** `JEFE_VENTAS`, `ADMIN`

### **GESTI√ìN DE GRUPOS DE IMPORTACI√ìN**

#### **Crear grupo de importaci√≥n**
```http
POST /api/jefe-ventas/grupos-importacion
```
**Descripci√≥n:** Crea un nuevo grupo de importaci√≥n
**Roles:** `JEFE_VENTAS`, `ADMIN`
**Body:**
```json
{
  "codigo": "GRUPO-2024-001",
  "descripcion": "Importaci√≥n de armas civiles Q1 2024",
  "fechaEstimadaLlegada": "2024-03-31T00:00:00Z",
  "costoTotal": 50000.00,
  "observaciones": "Importaci√≥n para clientes civiles"
}
```

#### **Obtener grupos de importaci√≥n**
```http
GET /api/jefe-ventas/grupos-importacion?page=0&size=10
```
**Descripci√≥n:** Obtiene grupos de importaci√≥n del jefe de ventas
**Roles:** `JEFE_VENTAS`, `ADMIN`

#### **Obtener grupo de importaci√≥n**
```http
GET /api/jefe-ventas/grupos-importacion/{grupoId}
```
**Descripci√≥n:** Obtiene un grupo de importaci√≥n espec√≠fico
**Roles:** `JEFE_VENTAS`, `ADMIN`

#### **Actualizar grupo de importaci√≥n**
```http
PUT /api/jefe-ventas/grupos-importacion/{grupoId}
```
**Descripci√≥n:** Actualiza un grupo de importaci√≥n
**Roles:** `JEFE_VENTAS`, `ADMIN`

### **ESTAD√çSTICAS Y REPORTES**

#### **Estad√≠sticas de clientes**
```http
GET /api/jefe-ventas/estadisticas/clientes
```
**Descripci√≥n:** Obtiene estad√≠sticas de clientes por estado y vendedor
**Roles:** `JEFE_VENTAS`, `ADMIN`

**Response:**
```json
{
  "totalClientes": 100,
  "clientesAprobados": 75,
  "clientesPendientes": 20,
  "clientesRechazados": 5,
  "clientesPorEstado": [
    ["ACTIVO", 80],
    ["BLOQUEADO", 15],
    ["INACTIVO", 5]
  ],
  "clientesPorVendedor": [
    ["Juan P√©rez", 25],
    ["Mar√≠a Garc√≠a", 30],
    ["Carlos L√≥pez", 45]
  ]
}
```

#### **Estad√≠sticas de licencias**
```http
GET /api/jefe-ventas/estadisticas/licencias
```
**Descripci√≥n:** Obtiene estad√≠sticas de licencias y cupos
**Roles:** `JEFE_VENTAS`, `ADMIN`

#### **Reporte de clientes pendientes**
```http
GET /api/jefe-ventas/reportes/clientes-pendientes
```
**Descripci√≥n:** Obtiene reporte de clientes pendientes de aprobaci√≥n
**Roles:** `JEFE_VENTAS`, `ADMIN`

---

## üîí **SEGURIDAD Y AUTORIZACI√ìN**

### **Roles Requeridos**
- `VENDEDOR` - Acceso a gesti√≥n de clientes y armas
- `JEFE_VENTAS` - Acceso a licencias e importaciones
- `ADMIN` - Acceso completo al sistema

### **Anotaciones de Seguridad**
- `@PreAuthorize("hasRole('ROLE')")` - Control de acceso por rol
- `@Valid` - Validaci√≥n de datos de entrada
- `@Transactional` - Control de transacciones

---

## üìä **VALIDACIONES IMPLEMENTADAS**

### **Clientes**
- ‚úÖ N√∫mero de identificaci√≥n √∫nico
- ‚úÖ Email √∫nico
- ‚úÖ Validaci√≥n de edad m√≠nima (25 a√±os)
- ‚úÖ Validaci√≥n de formato de c√©dula/RUC
- ‚úÖ Validaci√≥n de tel√©fonos
- ‚úÖ Campos obligatorios por tipo de cliente

### **Licencias**
- ‚úÖ N√∫mero de licencia √∫nico
- ‚úÖ Control de cupos disponibles
- ‚úÖ Validaci√≥n de fechas de vencimiento

### **Asignaciones**
- ‚úÖ Validaci√≥n de disponibilidad de armas
- ‚úÖ Control de cantidad positiva
- ‚úÖ Verificaci√≥n de permisos por vendedor

---

## üöß **PR√ìXIMOS PASOS**

### **Funcionalidades Pendientes**
- ‚è≥ Integraci√≥n con sistema de autenticaci√≥n JWT
- ‚è≥ Implementaci√≥n de notificaciones autom√°ticas
- ‚è≥ Generaci√≥n de documentos autom√°ticos
- ‚è≥ Sistema de auditor√≠a completo
- ‚è≥ Reportes avanzados y dashboards

### **Mejoras T√©cnicas**
- ‚è≥ Cache de consultas frecuentes
- ‚è≥ Optimizaci√≥n de consultas complejas
- ‚è≥ Implementaci√≥n de paginaci√≥n eficiente
- ‚è≥ Validaciones de negocio m√°s robustas

---

## üîó **ENLACES √öTILES**

- **Swagger UI**: `http://localhost:8080/swagger-ui.html`
- **Base de Datos**: PostgreSQL en puerto 5432
- **API Base**: `http://localhost:8080/api`
- **Documentaci√≥n**: `backend/ENDPOINTS_JEFE_VENTAS_VENDEDOR.md`

---

## üìù **NOTAS IMPORTANTES**

1. **Base de Datos**: Todas las entidades incluyen auditor√≠a (`fechaCreacion`, `fechaActualizacion`)
2. **Validaciones**: Implementadas tanto a nivel de entidad como de servicio
3. **Seguridad**: Control de acceso basado en roles implementado
4. **Documentaci√≥n**: Swagger configurado para documentaci√≥n autom√°tica
5. **Manejo de Errores**: Excepciones personalizadas y manejo global
6. **Transacciones**: Control de transacciones en operaciones cr√≠ticas 